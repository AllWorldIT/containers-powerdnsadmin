From bfa4e84f77c2aabbd430cb572fce650d06e503ff Mon Sep 17 00:00:00 2001
From: Nigel Kukard <nkukard@lbsd.net>
Date: Tue, 14 Mar 2023 12:53:30 +0000
Subject: [PATCH] fix(db:migrate): fix migration user 'confirmed' column
 migration when using MySQL databases

Fixes #635 which introduced a breaking change for MySQL databases and resolves #1446.
---
 migrations/versions/3f76448bb6de_add_user_confirmed_column.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/migrations/versions/3f76448bb6de_add_user_confirmed_column.py b/migrations/versions/3f76448bb6de_add_user_confirmed_column.py
index 490aebec3..6dcf16af4 100644
--- a/migrations/versions/3f76448bb6de_add_user_confirmed_column.py
+++ b/migrations/versions/3f76448bb6de_add_user_confirmed_column.py
@@ -23,7 +23,7 @@ def upgrade():
     with op.batch_alter_table('user') as batch_op:
         user = sa.sql.table('user', sa.sql.column('confirmed'))
         batch_op.execute(user.update().values(confirmed=False))
-        batch_op.alter_column('confirmed', nullable=False)
+        batch_op.alter_column('confirmed', nullable=False, existing_type=sa.Boolean(), existing_nullable=True, existing_server_default=False)
 
 
 def downgrade():
